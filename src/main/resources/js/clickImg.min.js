function ImgInfo(t){this.pageW=t.pageW,this.pageH=t.pageH,this.pageScale=this.pageH/this.pageW}function WxScale(t){this.moveData={ifStart:!1,startX:1,startY:1},this.scaleData={ifStart:!1,startDist:1},this.init(t),this.bindEvent()}ImgInfo.prototype={constructor:ImgInfo,reset:function(t){this.img=t;var i=this.img.getBoundingClientRect();this.scale=i.height/i.width,this.ifFullByHeight=this.scale>this.pageScale,this.ifFullByHeight?this.setHeight(this.pageH):this.setWidth(this.pageW),this.startAnitScale=.2},setWidth:function(t){this.w=t,this.h=this.w*this.scale,this.x=(this.pageW-this.w)/2,this.y=(this.pageH-this.h)/2},setHeight:function(t){this.h=this.pageH,this.w=this.h/this.scale,this.y=0,this.x=(this.pageW-this.w)/2},endScale:function(){this.w>this.pageW||this.h>this.pageH||(this.ifFullByHeight?this.setHeight(this.pageH):this.setWidth(this.pageW))},moveX:function(t){0<this.x||this.x+this.w<this.pageW?this.x+=t/5:this.x+=t},moveY:function(t){this.h<=this.pageH||(this.h>this.pageH&&0<this.y||this.h>this.pageH&&this.y+this.h<this.pageH?this.y+=t/5:this.y+=t)},move:function(t,i){this.moveX(t),this.moveY(i)},endMove:function(){0<this.x?this.x=this.ifFullByHeight&&this.w<this.pageW?(this.pageW-this.w)/2:0:this.x+this.w<this.pageW&&(this.x=this.ifFullByHeight&&this.w<this.pageW?(this.pageW-this.w)/2:this.pageW-this.w),this.h>this.pageH&&0<this.y?this.y=0:this.h>this.pageH&&this.y+this.h<this.pageH&&(this.y=this.pageH-this.h)},startAnit:function(t){var i=this;if(this.startAnitScale+=.05,this.startAnitDraw(t),1<=this.startAnitScale)return this.startAnitScale=1,this.startAnitDraw(t),void(this.startAnitScale=.2);requestAnimationFrame(function(){i.startAnit(t)})},startAnitDraw:function(t){t.clearRect(0,0,this.pageW,this.pageH),t.save();var i=this.w*this.startAnitScale,s=this.h*this.startAnitScale;t.translate((this.pageW-i)/2,(this.pageH-s)/2),t.beginPath(),t.drawImage(this.img,0,0,i,s),t.closePath(),t.restore()},draw:function(t){t.clearRect(0,0,this.pageW,this.pageH),t.save(),t.beginPath(),t.drawImage(this.img,this.x,this.y,this.w,this.h),t.closePath(),t.restore()}},WxScale.prototype={constructor:WxScale,init:function(t){this.fullPage=t.fullPage,this.canvas=t.canvas,this.fullPage.style.display="block";var i=this.canvas.getBoundingClientRect();this.w=this.canvas.width=i.width,this.h=this.canvas.height=i.height,this.ctx=canvas.getContext("2d"),this.img=new ImgInfo({pageW:this.w,pageH:this.h}),this.fullPage.style.display="none"},start:function(t){this.fullPage.style.display="block",this.img.reset(t),this.img.startAnit(this.ctx)},bindEvent:function(){var i=this;this.fullPage.addEventListener("touchstart",function(t){i.touchstart(t)},!1),this.fullPage.addEventListener("touchmove",function(t){i.touchmove(t)},!1),this.fullPage.addEventListener("touchend",function(t){i.touchend(t)},!1),this.fullPage.addEventListener("click",function(){this.style.display="none"},!1)},touchstart:function(t){1==t.touches.length?(this.moveData.ifStart=!0,this.moveData.startX=t.touches[0].pageX,this.moveData.startY=t.touches[0].pageY):2<=t.touches.length&&(this.scaleData.ifStart=!0,this.scaleData.startDist=this.getDistance(t.touches[0],t.touches[1]),this.imgBaseWidth=this.img.w)},touchmove:function(t){if(t.preventDefault(),this.moveData.ifStart&&1==t.touches.length){var i=t.touches[0].pageX-this.moveData.startX,s=t.touches[0].pageY-this.moveData.startY;this.moveData.startX=t.touches[0].pageX,this.moveData.startY=t.touches[0].pageY,this.img.move(i,s)}else if(this.scaleData.ifStart&&2<=t.touches.length){var h=(this.getDistance(t.touches[0],t.touches[1])/this.scaleData.startDist).toFixed(2);this.img.setWidth(this.imgBaseWidth*h)}this.img.draw(this.ctx)},touchend:function(t){this.scaleData.ifStart?(this.scaleData.ifStart=!1,this.moveData.ifStart=!1,this.img.endScale(),this.img.draw(this.ctx)):this.moveData.ifStart&&(this.moveData.ifStart=!1,this.img.endMove(),this.img.draw(this.ctx))},getDistance:function(t,i){var s=i.pageX-t.pageX,h=i.pageY-t.pageY;return Math.sqrt(s*s+h*h)}};